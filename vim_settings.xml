<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="/Dummy.txt" timestamp="1494946696163">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/ribbon/ribbon.component.html" timestamp="1493162440597">
        <mark key="'" line="154" column="0" />
      </file>
      <file name="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" timestamp="1494947734207">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="416" column="4" />
        <mark key="]" line="804" column="5" />
        <mark key="." line="416" column="0" />
        <mark key="^" line="415" column="3" />
        <mark key="n" line="153" column="36" />
      </file>
      <file name="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/ngate-master/ngate-master.component.ts" timestamp="1493163022047">
        <mark key="[" line="42" column="8" />
        <mark key="]" line="50" column="7" />
        <mark key="." line="50" column="7" />
        <mark key="^" line="50" column="7" />
      </file>
      <file name="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/endpoints.ts" timestamp="1493162387164">
        <mark key="[" line="11" column="44" />
        <mark key="]" line="11" column="43" />
        <mark key="^" line="11" column="43" />
        <mark key="." line="11" column="43" />
      </file>
      <file name="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/services/DND.service.ts" timestamp="1494947719166">
        <mark key="[" line="242" column="0" />
        <mark key="]" line="242" column="0" />
        <mark key="." line="242" column="0" />
      </file>
    </filemarks>
    <jumps>
      <jump line="54" column="13" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/ribbon/ribbon.component.html" />
      <jump line="154" column="0" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/ribbon/ribbon.component.html" />
      <jump line="627" column="0" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/services/DND.service.ts" />
      <jump line="191" column="33" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/services/DND.service.ts" />
      <jump line="439" column="4" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/services/DND.service.ts" />
      <jump line="191" column="12" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="207" column="8" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="147" column="0" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="341" column="0" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="146" column="36" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="18" column="30" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="45" column="25" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="74" column="21" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="112" column="25" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="118" column="29" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="124" column="25" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="136" column="44" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="53" column="0" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="258" column="34" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
      <jump line="0" column="0" filename="$USER_HOME$/Workspace/localhost-sro/manulogic-front/manulogic-2/src/app/components/DND/canvas/dnd-canvas.component.ts" />
    </jumps>
    <registers>
      <register name="1" type="2">
        <text encoding="base64">ICAgIC8qKgogICAgICogQ2hhbmdlIHRoZSBib3JkZXIgb2YgZWxlbWVudCB0byBpbmRpY2F0ZSBzZWxlY3Rpb24KICAgICAqIEBwYXJhbSB7UmVuZGVyZXJ9IHJlbmRlcmVyIC0gcmVmZXJlbmNlIHRvIGVsZW1lbnQgcmVuZGVyZXIKICAgICAqIEBwYXJhbSB7Vmlld0NvbnRhaW5lclJlZn0gdmlld1JlZiAtIHJlZmVyZW5jZSB0byBWaWV3CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNlbGVjdGVkIC0gaWYgaXMgdG8gYWRkIG9yIHJlbW92ZSB0aGUgZWZmZWN0CiAgICAgKi8KICAgIGNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyOiBSZW5kZXJlciwgdmlld1JlZjogVmlld0NvbnRhaW5lclJlZiwgc2VsZWN0ZWQ6IGJvb2xlYW4pIHsKICAgICAgICB2aWV3UmVmLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jaGlsZE5vZGVzLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgIGlmIChpdGVtLmNsYXNzTmFtZSAmJiBpdGVtLmNsYXNzTmFtZS5pbmRleE9mKCdkcmFnZ2FibGUtZWxlbWVudCcpICE9PSAtMSkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0RWxlbWVudENsYXNzKGl0ZW0sICdoaWdobGlnaHQtZWxlbWVudCcsIHNlbGVjdGVkKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogRW1wdHkgdGhlIGxpc3Qgb2Ygc2VsZWN0ZWQgZWxlbWVudHMgYW5kIHJlbW92ZSB0aGUgY3NzIGVmZmVjdAogICAgICogQHBhcmFtIHtSZW5kZXJlcn0gcmVuZGVyZXIgLSByZWZlcmVuY2UgdG8gY3VycmVudCByZW5kZXJlcgogICAgICovCiAgICBlbXB0eVNlbGVjdGVkRWxlbWVudHMocmVuZGVyZXIpIHsKICAgICAgICBjb25zdCBsaXN0TGVuZ3RoID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3RMZW5ndGg7ICsraSkgewogICAgICAgICAgICB0aGlzLmNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyLCB0aGlzLnNlbGVjdGVkRWxlbWVudHNbaV0udmlld1JlZiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGVkRWxlbWVudHMuc3BsaWNlKDAsIGxpc3RMZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBjb29yZGluYXRlcyBvZiBlbGVtZW50cyBzZWxlY3RlZCBhbmQgdXNlIHRoZSB0byBjcmVhdGUgYSBncm91cCBlbGVtZW50CiAgICAgKiB3aXRoIGNvcnJlY3Qgc2l6ZS4KICAgICAqLwogICAgY29vcmRzRm9yR3JvdXBpbmcoKSB7CiAgICAgICAgY29uc3QgY29vcmRzID0gewogICAgICAgICAgICB0b3A6IHRoaXMuc2VsZWN0ZWRFbGVtZW50c1swXS5ub2RlLmRhdGEueSwKICAgICAgICAgICAgbGVmdDogdGhpcy5zZWxlY3RlZEVsZW1lbnRzWzBdLm5vZGUuZGF0YS54LAogICAgICAgICAgICBib3R0b206IHRoaXMuc2VsZWN0ZWRFbGVtZW50c1swXS5ub2RlLmRhdGEuaGVpZ2h0LAogICAgICAgICAgICByaWdodDogdGhpcy5zZWxlY3RlZEVsZW1lbnRzWzBdLm5vZGUuZGF0YS53aWR0aCwKICAgICAgICB9OwogICAgICAgIC8vIGdvIHRocm91Z2ggZXZlcnkgaXRlbSBnZXR0aW5nIHRoZSBjb29yZGluYXRlcyBnb3IgZ3JvdXAgZWxlbWVudAogICAgICAgIHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICBjb29yZHMudG9wID0gY29vcmRzLnRvcCA+IGl0ZW0ubm9kZS5kYXRhLnkgPyBpdGVtLm5vZGUuZGF0YS55IDogY29vcmRzLnRvcDsKICAgICAgICAgICAgY29vcmRzLmxlZnQgPSBjb29yZHMubGVmdCA+IGl0ZW0ubm9kZS5kYXRhLnggPyBpdGVtLm5vZGUuZGF0YS54IDogY29vcmRzLmxlZnQ7CiAgICAgICAgICAgIGNvbnN0IHdpZHRoRnJvbUJvcmRlciA9IGl0ZW0ubm9kZS5kYXRhLnggKyBpdGVtLm5vZGUuZGF0YS53aWR0aDsKICAgICAgICAgICAgY29vcmRzLnJpZ2h0ID0gY29vcmRzLnJpZ2h0ID4gd2lkdGhGcm9tQm9yZGVyID8gY29vcmRzLnJpZ2h0IDogd2lkdGhGcm9tQm9yZGVyOwogICAgICAgICAgICBjb25zdCBoZWlnaHRGcm9tQm9yZGVyID0gaXRlbS5ub2RlLmRhdGEueSArIGl0ZW0ubm9kZS5kYXRhLmhlaWdodDsKICAgICAgICAgICAgY29vcmRzLmJvdHRvbSA9IGNvb3Jkcy5ib3R0b20gPiBoZWlnaHRGcm9tQm9yZGVyID8gY29vcmRzLmJvdHRvbSA6IGhlaWdodEZyb21Cb3JkZXI7CiAgICAgICAgfSk7CiAgICAgICAgLy8gZml4IGZvciB0aGUgc2l6ZSBvZiB0aGUgZWxlbWVudCwgbWF5YmUgc29tZSBjb25mbGljdCB3aXRoIHRoZSBwb3NpdGlvbgogICAgICAgIGNvb3Jkcy5yaWdodCA9IGNvb3Jkcy5yaWdodCAtIGNvb3Jkcy5sZWZ0OwogICAgICAgIGNvb3Jkcy5ib3R0b20gPSBjb29yZHMuYm90dG9tIC0gY29vcmRzLnRvcDsKICAgICAgICByZXR1cm4gY29vcmRzOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0L1VuLXNlbGVjdCB0aGUgZWxlbWVudCBjbGlja2VkLgogICAgICovCiAgICBzZWxlY3RFbGVtZW50cyh2aWV3UmVmOiBWaWV3Q29udGFpbmVyUmVmLCByZW5kZXJlcjogUmVuZGVyZXIsIG5vZGUpIHsKICAgICAgICAvLyByZW1vdmUgLyBpbnNlcnQgdG8gYSBsaXN0IG9mIHNlbGVjdGVkIGVsZW1lbnRzCiAgICAgICAgY29uc3Qgbm9kZURhdGEgPSBub2RlLmRhdGE7CiAgICAgICAgY29uc3QgY2FudmFzUmVmID0gdGhpcy5nZXRBY3RpdmVDYW52YXMoKTsKICAgICAgICBjb25zdCBub2RlSW5kZXggPSB0aGlzLnNlbGVjdGVkRWxlbWVudHMuZmluZEluZGV4KGl0ZW0gPT4gewogICAgICAgICAgICByZXR1cm4gaXRlbS5ub2RlLmRhdGEgPT09IG5vZGVEYXRhOwogICAgICAgIH0pOwogICAgICAgIC8vIGluc2VydCBpZiBub3QgZm91bmQKICAgICAgICBpZiAobm9kZUluZGV4ID09PSAtMSkgewogICAgICAgICAgICB0aGlzLmNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyLCB2aWV3UmVmLCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnRzLnB1c2goe3ZpZXdSZWYsIG5vZGUsIGNhbnZhc1JlZn0pOwogICAgICAgIH0gZWxzZSB7IC8vIHJlbW92ZSBpZiBpdCB3YXMgZm91bmQKICAgICAgICAgICAgdGhpcy5jaGFuZ2VCb3JkZXJDb2xvcihyZW5kZXJlciwgdmlld1JlZiwgZmFsc2UpOwogICAgICAgICAgICB0aGlzLnNlbGVjdGVkRWxlbWVudHMuc3BsaWNlKG5vZGVJbmRleCwgMSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR3JvdXAgZWxlbWVudHMgc2VsZWN0ZWQKICAgICAqIEBwYXJhbSBjb29yZHMgLSBjb29yZGluYXRlcyBmb3IgY3JlYXRlIGEgZ3JvdXAgImJveCIKICAgICAqIEBwYXJhbSBlbGVtZW50Q29tcG9uZW50IC0gZWxlbWVudCB0byBiZSBjcmVhdGVkCiAgICAgKiBAcGFyYW0gcmVuZGVyZXIgLSByZWZlcmVuY2Ugb2YgcmVuZGVyZXIgZWxlbWVudAogICAgICogQHBhcmFtIGRlbGV0ZUVsZW1lbnRDYWxsYmFjayAtIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGRlbGV0ZSB0aGUgZWxlbWVudHMgYWZ0ZXIgaW5zZXJ0ZWQgb24gZ3JvdXAKICAgICAqLwogICAgZ3JvdXBFbGVtZW50cyhjb29yZHMsIGVsZW1lbnRDb21wb25lbnQsIHJlbmRlcmVyLCBkZWxldGVFbGVtZW50Q2FsbGJhY2spIHsKICAgICAgICBjb25zdCB5ID0gY29vcmRzLnRvcDsKICAgICAgICBjb25zdCB4ID0gY29vcmRzLmxlZnQ7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gY29vcmRzLmJvdHRvbTsKICAgICAgICBjb25zdCB3aWR0aCA9IGNvb3Jkcy5yaWdodDsKICAgICAgICAvLyBjYW52YXMgd2hlcmUgZWxlbWVudHMgd2lsbCBiZSBhZGRlZAogICAgICAgIGNvbnN0IGNhbnZhc1JlZiA9IHRoaXMuZ2V0QWN0aXZlQ2FudmFzKCk7CiAgICAgICAgY29uc3QgY2FudmFzSWQgPSBjYW52YXNSZWYuY2FudmFzSWQ7IC8vIGNhbnZhcyBpZAogICAgICAgIGNvbnN0IGNhbnZhc0VsUmVmID0gY2FudmFzUmVmLnRoaXNSZWYuZWwubmF0aXZlRWxlbWVudDsgLy8gRE9NIGVsZW0KICAgICAgICBjb25zdCBjYW52YXNWaWV3Q2hpbGQgPSBjYW52YXNSZWYudGhpc1JlZi5jYW52YXNWaWV3UmVmOyAvLyB2aWV3Q2hpbGQgd2hlcmUgZWxlbWVudHMgYXJlIGFkZGVkCgogICAgICAgIC8vIGNyZWF0ZSBhIGdyb3VwIGVsZW1lbnQKICAgICAgICBjb25zdCBncm91cE5vZGUgPSB0aGlzLmNyZWF0ZUNhbnZhc0VsZW1lbnROb2RlKHgsIHksIHt0eXBlOiAnbm9kZSd9LCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gZ2V0IHRoZSBlbGVtZW50cyB0byBiZSBncm91cGVkCiAgICAgICAgY29uc3QgY3VycmVudENhbnZhc0VsZW1lbnRzID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmZpbHRlcigoaXRlbSkgPT4KICAgICAgICAgICAgKGl0ZW0uY2FudmFzUmVmLmNhbnZhc0lkID09PSBjYW52YXNSZWYuY2FudmFzSWQpCiAgICAgICAgKTsKCiAgICAgICAgLy8gcmVtb3ZlIHRoZW0gZnJvbSBzZWxlY3RlZCBsaXN0IGFuZCBwdXNoIGludG8gbm9kZQogICAgICAgIGN1cnJlbnRDYW52YXNFbGVtZW50cy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmluZGV4T2YoaXRlbSk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIC8vIGZpeCBwb3NpdGlvbiBvZiBub2RlCiAgICAgICAgICAgICAgICBpdGVtLm5vZGUuZGF0YS54ID0gaXRlbS5ub2RlLmRhdGEueCAtIHg7CiAgICAgICAgICAgICAgICBpdGVtLm5vZGUuZGF0YS55ID0gaXRlbS5ub2RlLmRhdGEueSAtIHk7CiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIG5vZGUgdHJlZQogICAgICAgICAgICAgICAgZ3JvdXBOb2RlLm5vZGVzLnB1c2goaXRlbS5ub2RlKTsKICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBlbGVtZW50IGZyb20gY2FudmFzCiAgICAgICAgICAgICAgICBkZWxldGVFbGVtZW50Q2FsbGJhY2soaXRlbS5ub2RlKTsKICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBlbGVtZW50IGZyb20gc2VsZWN0ZWQgbGlzdAogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyLCBpdGVtLnZpZXdSZWYsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcjogZWxlbWVudCBub3QgZm91bmQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBjb21wb25lbnREYXRhID0gdGhpcy5jcmVhdGVFbGVtZW50Q29tcG9uZW50KGNhbnZhc0VsUmVmLCBjYW52YXNJZCwgZ3JvdXBOb2RlLCBlbGVtZW50Q29tcG9uZW50KTsKCiAgICAgICAgdGhpcy5faW5zdGFuY2VTZXJ2aWNlLmFkZENvbXBvbmVudFRvQ29tcG9uZW50KGNhbnZhc1ZpZXdDaGlsZCwgY29tcG9uZW50RGF0YSk7CiAgICAgICAgdGhpcy5hZGRFbGVtVG9Eb2N1bWVudChncm91cE5vZGUpOwogICAgfQoKICAgIC8qKgogICAgICogVW5ncm91cCBlbGVtZW50cyBzZWxlY3RlZAogICAgICogQHBhcmFtIGVsZW1lbnRDb21wb25lbnQgLSBlbGVtZW50IHRvIGJlIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBkZWxldGVFbGVtZW50Q2FsbGJhY2sgLSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZWxldGUgdGhlIGVsZW1lbnRzIGFmdGVyIGluc2VydGVkIG9uIGdyb3VwCiAgICAgKi8KICAgIHVuZ3JvdXBFbGVtZW50cyhlbGVtZW50Q29tcG9uZW50LCBkZWxldGVFbGVtZW50Q2FsbGJhY2spIHsKICAgICAgICAvLyBjYW52YXMgd2hlcmUgZWxlbWVudHMgd2lsbCBiZSBhZGRlZAogICAgICAgIGNvbnN0IGNhbnZhc1JlZiA9IHRoaXMuZ2V0QWN0aXZlQ2FudmFzKCk7CiAgICAgICAgY29uc3QgY2FudmFzSWQgPSBjYW52YXNSZWYuY2FudmFzSWQ7IC8vIGNhbnZhcyBpZAogICAgICAgIGNvbnN0IGNhbnZhc0VsUmVmID0gY2FudmFzUmVmLnRoaXNSZWYuZWwubmF0aXZlRWxlbWVudDsgLy8gRE9NIGVsZW0KICAgICAgICBjb25zdCBjYW52YXNWaWV3Q2hpbGQgPSBjYW52YXNSZWYudGhpc1JlZi5jYW52YXNWaWV3UmVmOyAvLyB2aWV3Q2hpbGQgd2hlcmUgZWxlbWVudHMgYXJlIGFkZGVkCgogICAgICAgIC8vIGdldCB0aGUgZ3JvdXBzCiAgICAgICAgY29uc3QgY3VycmVudE5vZGVFbGVtZW50cyA9IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5maWx0ZXIoKGl0ZW0pID0+CiAgICAgICAgICAgIChpdGVtLmNhbnZhc1JlZi5jYW52YXNJZCA9PT0gY2FudmFzUmVmLmNhbnZhc0lkICYmIGl0ZW0ubm9kZS5kYXRhLnR5cGVOYW1lID09PSAnbm9kZScpCiAgICAgICAgKTsKCiAgICAgICAgLy8gcmVtb3ZlIGluc2lkZSBub2RlcyBhbmQgYWRkIHRoZW0gaW4gY2FudmFzCiAgICAgICAgY3VycmVudE5vZGVFbGVtZW50cy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmluZGV4T2YoaXRlbSk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGl0ZW0ubm9kZS5ub2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhLnggKz0gaXRlbS5ub2RlLmRhdGEueDsKICAgICAgICAgICAgICAgICAgICBub2RlLmRhdGEueSArPSBpdGVtLm5vZGUuZGF0YS55OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudERhdGEgPSB0aGlzLmNyZWF0ZUVsZW1lbnRDb21wb25lbnQoY2FudmFzRWxSZWYsIGNhbnZhc0lkLCBub2RlLCBlbGVtZW50Q29tcG9uZW50KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVNlcnZpY2UuYWRkQ29tcG9uZW50VG9Db21wb25lbnQoY2FudmFzVmlld0NoaWxkLCBjb21wb25lbnREYXRhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEVsZW1Ub0RvY3VtZW50KG5vZGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkZWxldGVFbGVtZW50Q2FsbGJhY2soaXRlbS5ub2RlKTsKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yOiBlbGVtZW50IG5vdCBmb3VuZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgoKICAgIC8qKiBHZXQgdGhlIGxvd2VzdCBwb3NpdGlvbiAoeSBheGlzKSBvbiBjYW52YXMgKi8KICAgIGdldExvd2VzdEZyZWVQb3NpdGlvbigpOiBudW1iZXIgewogICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5nZXROb2RlcygpOwogICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGxldCBib3R0b20gPSBub2Rlc1swXS5kYXRhLnkgKyBub2Rlc1swXS5kYXRhLmhlaWdodDsKICAgICAgICBub2Rlcy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICBjb25zdCBpdGVtQm90dG9tID0gaXRlbS5kYXRhLnkgKyBpdGVtLmRhdGEuaGVpZ2h0OwogICAgICAgICAgICBpZiAoYm90dG9tIDwgaXRlbUJvdHRvbSkgewogICAgICAgICAgICAgICAgYm90dG9tID0gaXRlbUJvdHRvbTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIC8vIGF2b2lkIGNvbGxpc2lvbnMsIGFkZCBvbmUgY2VsbCBoZWlnaHQgKC0xIHRvIG5vdCBqdW1wIHRoZSB3aG9sZSBjZWxsKSB0byBtb3ZlIHRvIHRoZSBuZXh0IGNlbGwKICAgICAgICBib3R0b20gKz0gdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQudlNpemUgLSAxOwogICAgICAgIC8vIHJvd3MgLTEgaXMgdG8gbm90IGFkZCBpbiB0aGUgbGFzdCBncmlkIHBvaW50IChvdXQgb2YgY2FudmFzKQogICAgICAgIGlmIChib3R0b20gPj0gKHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplICogKHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnJvd3MgLSAxKSkpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYm90dG9tOwogICAgfQoKICAgIC8qKiBHZXQgdGhlIHdpZHRoIG9mIHRoZSBjYW52YXMgZm9yIHRoZSBhZGRlZCBlbGVtZW50LCAtMiB0byBiZSBpbnNpZGUgb2YgdGhlIGJvdW5kYXJpZXMgKi8KICAgIGdldEZ1bGxDYW52YXNXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuY2FudmFzV2lkdGggLSAyOwogICAgfQoKICAgIC8qKgogICAgICogVHJlYXQgZWxlbWVudHMgd2hlbiBpdCBjb2xsaWRlcywgaWYgbW92aW5nIHRoZSBvdGhlciBvYmplY3RzIHdpbGwgY2hhbmdlIHRoZSBwb3NpdGlvbgogICAgICogaWYgcmVzaXppbmcgdGhlIG9iamVjdCB3aWxsIHN0b3AgdG8gaW5jcmVhc2UuIE5vdGljZSB0aGF0IHdoZW4gbW92aW5nIGl0IG5vdCByZXR1cm4gdHJ1ZSBidXQKICAgICAqIGNoYW5nZSB0aGUgb3RoZXIgZWxlbWVudHMgcG9zaXRpb24gaW5zdGVhZC4KICAgICAqIEBwYXJhbSB7YW55fSBwb3MgLSBuZXcgcG9zaXRpb24gb2YgZWxlbWVudCAoc3RyaWN0IHRvIG1vdXNlIHBvc2l0aW9uIG9yIGVsZW1lbnQgaGVpZ2h0IGFuZCB3aWR0aCkKICAgICAqIEBwYXJhbSB7YW55fSBub2RlIC0gdGhlIGN1cnJlbnQgbm9kZSBiZWluZyB1c2VkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZSAtICdtb3ZlJyBvciAncmVzaXplJwogICAgICogQHJldHVybnMge2Jvb2xlYW59IGlzIGNvbGxpZGluZyBvciBub3QKICAgICAqLwogICAgaXNDb2xsaWRpbmcocG9zLCBub2RlLCBtb2RlKSB7CiAgICAgICAgLy8gaWYgaXMgbW92aW5nIGVsZW1lbnQgcG9zIHNob3VsZCBiZSBjYWxjdWxhdGVkIGZyb20gc25hcCBwb2ludHMKICAgICAgICBjb25zdCBuZXdQb3MgPSBtb2RlID09PSAnbW92ZScgPyB0aGlzLmdldFNuYXBQb2ludChwb3MubGVmdCwgcG9zLnRvcCkgOiBwb3M7CgogICAgICAgIC8vIHBvcyB3aGlsZSByZXNpemluZyBoYXMgaW5mb3JtYXRpb24gYWJvdXQgZWxlbWVudCB3aWR0aCBhbmQgaGVpZ2h0CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dldEN1cnJlbnROb2RlTWV0cmljcyhub2RlLCBuZXdQb3MsIG1vZGUpOwoKICAgICAgICAvLyBnZXQgYWxsIG5vZGVzIGluIGNhbnZhcwogICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5nZXROb2RlcygpOwoKICAgICAgICAvLyBydW4gdHJvdWdoIGFsbCBlbGVtZW50cyBhbmQgc2VlIGlmIGl0IHdpbGwgY29sbGlkZQogICAgICAgIGZvciAoY29uc3QgX25vZGUgb2Ygbm9kZXMpIHsKICAgICAgICAgICAgaWYgKF9ub2RlICE9PSBub2RlKSB7CiAgICAgICAgICAgICAgICAvLyB0YWtlIHRoZSBtZWFzdXJlcwogICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuX2dldE90aGVyTm9kZXNNZXRyaWNzKF9ub2RlKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl93aWxsQ29sbGlkZShhLCBiKSkgewogICAgICAgICAgICAgICAgICAgIC8vIG1vdmluZyBmcm9tIHNpZGVzLCByZXR1cm4gdGhhdCB3aWxsIGNvbGxpZGUgYW5kIGRvbid0IG1vdmUKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhLnkgPT09IF9ub2RlLmRhdGEueSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGlmIGlzIHJlc2l6aW5nLCBqdXN0IHJldHVybiB0cnVlIHRvIHN0b3AgdGhlIG9iamVjdCB0byBjaGFuZ2UgdGhlIHNpemUKICAgICAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gJ3Jlc2l6ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB3aGlsZSBtb3ZpbmcgYW4gb2JqZWN0IHRoZSBjdXJyZW50IG9iamVjdCBzaG91bGQgbW92ZSBvdGhlciBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGUgPT09ICdtb3ZlJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZWxlbU1vdmVkVXAobm9kZSwgX25vZGUpICYmIHRoaXMuX2VsZW1BdEZpcnN0Q2VsbE9uQ29uZmxpY3QocG9zLCBfbm9kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc1RvTW92ZSA9IHRoaXMuX3BsYWNlVG9Nb3ZlRG93bihuZXdQb3MsIG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX25vZGUuZGF0YS55ID0gdGhpcy5nZXRTbmFwUG9pbnQoX25vZGUuZGF0YS54LCBwb3NUb01vdmUpLnRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9lbGVtTW92ZWREb3duKG5vZGUsIF9ub2RlKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1BdExhc3RDZWxsT25Db25mbGljdChwb3MsIG5vZGUsIF9ub2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zVG9Nb3ZlID0gdGhpcy5fcGxhY2VUb01vdmVVcChub2RlLCBfbm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbm9kZS5kYXRhLnkgPSB0aGlzLmdldFNuYXBQb2ludChfbm9kZS5kYXRhLngsIHBvc1RvTW92ZSkudG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB1bmV4cGVjdGVkIHNpdHVhdGlvbnMgd2hpbGUgbW92aW5nLCByZXR1cm4gdHJ1ZSBhbmQgZG9uJ3QgbW92ZQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBfZ2V0Q3VycmVudE5vZGVNZXRyaWNzKG5vZGUsIHBvcywgbW9kZSk6IGFueSB7CiAgICAgICAgY29uc3QgYTogYW55ID0ge307CiAgICAgICAgYS5yaWdodCA9IG1vZGUgPT09ICdyZXNpemUnID8gbm9kZS5kYXRhLnggKyBwb3Mud2lkdGggOiBub2RlLmRhdGEud2lkdGggKyBwb3MubGVmdDsKICAgICAgICBhLmxlZnQgPSBtb2RlID09PSAnbW92ZScgPyBwb3MubGVmdCA6IG5vZGUuZGF0YS54OwogICAgICAgIGEuYm90dG9tID0gbW9kZSA9PT0gJ3Jlc2l6ZScgPyBub2RlLmRhdGEueSArIHBvcy5oZWlnaHQgOiBub2RlLmRhdGEuaGVpZ2h0ICsgcG9zLnRvcDsKICAgICAgICBhLnRvcCA9IG1vZGUgPT09ICdtb3ZlJyA/IHBvcy50b3AgOiBub2RlLmRhdGEueTsKICAgICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBfZ2V0T3RoZXJOb2Rlc01ldHJpY3Mobm9kZSk6IGFueSB7CiAgICAgICAgY29uc3QgYjogYW55ID0ge307CiAgICAgICAgYi5yaWdodCA9IG5vZGUuZGF0YS54ICsgbm9kZS5kYXRhLndpZHRoOwogICAgICAgIGIubGVmdCA9IG5vZGUuZGF0YS54OwogICAgICAgIGIuYm90dG9tID0gbm9kZS5kYXRhLnkgKyBub2RlLmRhdGEuaGVpZ2h0OwogICAgICAgIGIudG9wID0gbm9kZS5kYXRhLnk7CiAgICAgICAgcmV0dXJuIGI7CiAgICB9CgogICAgX3dpbGxDb2xsaWRlKGE6IGFueSwgYjogYW55KSB7CiAgICAgICAgcmV0dXJuIGIucmlnaHQgPiBhLmxlZnQgJiYgYS5yaWdodCA+IGIubGVmdCAmJiBiLmJvdHRvbSA+IGEudG9wICYmIGEuYm90dG9tID4gYi50b3A7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBPVEhFUiBlbGVtZW50IHNob3VsZCBiZSBwbGFjZWQgKGRvd24pIHdoaWxlIHRoZSBjdXJyZW50CiAgICAgKiBlbGVtZW50IGlzIGJlaW5nIG1vdmVkIHVwLgogICAgICogQHBhcmFtIHBvcyAtIGN1cnJlbnQgbW91c2UgcG9zaXRpb24KICAgICAqIEBwYXJhbSBjdXJyZW50Tm9kZSAtIG5vZGUgYmVpbmcgbW92ZWQKICAgICAqLwogICAgX3BsYWNlVG9Nb3ZlRG93bihwb3MsIGN1cnJlbnROb2RlKSB7CiAgICAgICAgaWYgKGN1cnJlbnROb2RlLmRhdGEuaGVpZ2h0IDw9IHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplKSB7CiAgICAgICAgICAgIHJldHVybiBwb3MudG9wICsgdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQudlNpemU7CiAgICAgICAgfQogICAgICAgIC8vIG51bWJlciBvZiBjZWxscyBiZWluZyBvY2N1cGllZCBieSBlbGVtZW50CiAgICAgICAgY29uc3QgY2VsbHMgPSBjdXJyZW50Tm9kZS5kYXRhLmhlaWdodCAvIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplICsgMTsKICAgICAgICByZXR1cm4gcG9zLnRvcCArIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplICogY2VsbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBPVEhFUiBlbGVtZW50IHNob3VsZCBiZSBwbGFjZWQgKHVwKSB3aGlsZSB0aGUgY3VycmVudAogICAgICogZWxlbWVudCBpcyBiZWluZyBtb3ZlZCBkb3duLgogICAgICogQHBhcmFtIGN1cnJlbnROb2RlIC0gbm9kZSBiZWluZyBtb3ZlZAogICAgICogQHBhcmFtIG90aGVyTm9kZSAtIG5vZGUgYmVpbmcgYWZmZWN0ZWQgYnkgbW92ZWQgZWxlbWVudAogICAgICovCiAgICBfcGxhY2VUb01vdmVVcChjdXJyZW50Tm9kZSwgb3RoZXJOb2RlKSB7CiAgICAgICAgaWYgKGN1cnJlbnROb2RlLmRhdGEuaGVpZ2h0ID4gb3RoZXJOb2RlLmRhdGEuaGVpZ2h0KSB7CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBlbGVtZW50IGlzIGJlaW5nIG1vdmVkIGRvd24KICAgICAqIEBwYXJhbSBjdXJyZW50Tm9kZSAtIG5vZGUgYmVpbmcgbW92ZWQKICAgICAqIEBwYXJhbSBvdGhlck5vZGUgLSBub2RlIGJlaW5nIGFmZmVjdGVkIGJ5IG1vdmVkIG5vZGUKICAgICAqLwogICAgX2VsZW1Nb3ZlZERvd24oY3VycmVudE5vZGUsIG90aGVyTm9kZSkgewogICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnkgPCBvdGhlck5vZGUuZGF0YS55OwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgZWxlbWVudCBpcyBiZWluZyBtb3ZlZCB1cAogICAgICogQHBhcmFtIGN1cnJlbnROb2RlIC0gbm9kZSBiZWluZyBtb3ZlZAogICAgICogQHBhcmFtIG90aGVyTm9kZSAtIG5vZGUgYmVpbmcgYWZmZWN0ZWQgYnkgbW92ZWQgbm9kZQogICAgICovCiAgICBfZWxlbU1vdmVkVXAoY3VycmVudE5vZGUsIG90aGVyTm9kZSkgewogICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnkgPiBvdGhlck5vZGUuZGF0YS55OwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGVsZW1lbnQgYmVpbmcgbW92ZWQgaXMgaW4gdGhlIGZpcnN0IGNlbGwgb2YgYWZmZWN0ZWQgZWxlbWVudC4KICAgICAqIE5PVElDRTogdGhpcyBpcyBhIHdvcmthcm91bmQgdG8gdHJ5IGF2b2lkIHNvbWUgb3ZlcmxhcHBpbmcgd2l0aCBiaWcgZWxlbWVudHMgdGhhbiBvbmUgY2VsbCBlbGVtZW50cy4KICAgICAqIEBwYXJhbSBwb3MgLSBjdXJyZW50IG1vdXNlIHBvcwogICAgICogQHBhcmFtIG90aGVyTm9kZSAtIG5vZGUgYmVpbmcgYWZmZWN0ZWQgYnkgbW92ZWQgbm9kZQogICAgICovCiAgICBfZWxlbUF0Rmlyc3RDZWxsT25Db25mbGljdChwb3MsIG90aGVyTm9kZSkgewogICAgICAgIHJldHVybiBNYXRoLmFicyhwb3MudG9wIC0gb3RoZXJOb2RlLmRhdGEueSkgPCB0aGlzLkNBTlZBU19DT05GSUcuZ3JpZC52U2l6ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBlbGVtZW50IGJlaW5nIG1vdmVkIGlzIGluIHRoZSBsYXN0IGNlbGwgb2YgYWZmZWN0ZWQgZWxlbWVudC4KICAgICAqIE5PVElDRTogdGhpcyBpcyBhIHdvcmthcm91bmQgdG8gdHJ5IGF2b2lkIHNvbWUgb3ZlcmxhcHBpbmcgd2l0aCBiaWdnZXIgdGhhbiBvbmUgY2VsbCBlbGVtZW50cy4KICAgICAqIEBwYXJhbSBwb3MgLSBjdXJyZW50IG1vdXNlIHBvcwogICAgICogQHBhcmFtIGN1cnJlbnROb2RlIC0gY3VycmVudCBub2RlIGJlaW5nIG1vdmVkCiAgICAgKiBAcGFyYW0gb3RoZXJOb2RlIC0gbm9kZSBiZWluZyBhZmZlY3RlZCBieSBtb3ZlZCBub2RlCiAgICAgKi8KICAgIF9lbGVtQXRMYXN0Q2VsbE9uQ29uZmxpY3QocG9zLCBjdXJyZW50Tm9kZSwgb3RoZXJOb2RlKSB7CiAgICAgICAgaWYgKG90aGVyTm9kZS5kYXRhLmhlaWdodCA8IGN1cnJlbnROb2RlLmRhdGEuaGVpZ2h0KSB7CiAgICAgICAgICAgIHJldHVybiBwb3MudG9wICsgY3VycmVudE5vZGUuZGF0YS5oZWlnaHQgPiBvdGhlck5vZGUuZGF0YS55ICsgb3RoZXJOb2RlLmRhdGEuaGVpZ2h0OwogICAgICAgIH0KICAgICAgICBjb25zdCB2U2l6ZXNNdWx0ID0gTWF0aC5jZWlsKG90aGVyTm9kZS5kYXRhLmhlaWdodCAvIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplKSAtIDE7CiAgICAgICAgY29uc3QgY29uZlNwYWNlID0gdlNpemVzTXVsdCAqIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplOwogICAgICAgIHJldHVybiBwb3MudG9wID4gb3RoZXJOb2RlLmRhdGEueSArIGNvbmZTcGFjZTsKICAgIH0KCiAgICAvKiogR2V0IG5vZGUgbGlzdCBvZiBzZWxlY3RlZFRhYiAqLwogICAgZ2V0Tm9kZXMoKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRMYW5nID0gdGhpcy5fZGFzaGJvYXJkU2VydmljZS5zZWxlY3RlZFRhYi50YWJTdGF0ZS5jdXJyTGFuZ0NvZGU7CiAgICAgICAgaWYgKHRoaXMuX2Rhc2hib2FyZFNlcnZpY2Uuc2VsZWN0ZWRUYWIuZG9jdW1lbnQudHlwZSA9PT0gJ05HQVRFX01BU1RFUicpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rhc2hib2FyZFNlcnZpY2Uuc2VsZWN0ZWRUYWIuZG9jdW1lbnQubmdhdGVzW3NlbGVjdGVkTGFuZ10KICAgICAgICAgICAgICAgIC5ncmFwaGljc1JlcHJlc2VudGF0aW9uLmVsZW1lbnRzLm5vZGVzOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5fZGFzaGJvYXJkU2VydmljZS5zZWxlY3RlZFRhYi5kb2N1bWVudC50eXBlID09PSAnTE9HSUNfTUFTVEVSJykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGFzaGJvYXJkU2VydmljZS5zZWxlY3RlZFRhYi5kb2N1bWVudC5sb2dpY3Nbc2VsZWN0ZWRMYW5nXS5lbGVtZW50cy5ub2RlczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgZWxlbWVudCBpcyBpbiBwb3NpdGlvbiBhY2NvcmRpbmcgdG8gYm91bmRhcnkgZWxlbWVudAogICAgICogZS5nLiBkcmFnZ2FibGUgZWxlbWVudCBpcyBzdGlsbCBpbnNpZGUgY2FudmFzCiAgICAgKiBAcGFyYW0gYm91bmRhcmllcyAtIG9iamVjdCB3aXRoIGJvdW5kYXJpZXMgbWV0cmljcwogICAgICogQHBhcmFtIGxlZnQKICAgICAqIEBwYXJhbSB0b3AKICAgICAqIEBwYXJhbSB3aWR0aAogICAgICogQHBhcmFtIGhlaWdodAogICAgICogQHJldHVybnMge2Jvb2xlYW59IGlmIGlzIG9yIGlzIG5vdCBpbiBib3VuZGFyaWVzCiAgICAgKi8KCiAgICBpc0luQm91bmRhcmllcyhib3VuZGFyaWVzLCBsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAvLyBnZXQgc25hcCBwb2ludHMgcG9zaXRpb24KICAgICAgICBjb25zdCBuZXdQb3MgPSB0aGlzLmdldFNuYXBQb2ludChsZWZ0LCB0b3ApOwogICAgICAgIGNvbnN0IGVsZW1NZXRyaWNzID0gewogICAgICAgICAgICBsZWZ0OiBuZXdQb3MubGVmdCwKICAgICAgICAgICAgdG9wOiBuZXdQb3MudG9wLAogICAgICAgICAgICByaWdodDogbmV3UG9zLmxlZnQgKyB3aWR0aCwKICAgICAgICAgICAgYm90dG9tOiBuZXdQb3MudG9wICsgaGVpZ2h0CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZWxlbU1ldHJpY3MubGVmdCA+IGJvdW5kYXJpZXMubGVmdCAmJgogICAgICAgICAgICBlbGVtTWV0cmljcy5yaWdodCA8IGJvdW5kYXJpZXMucmlnaHQgJiYKICAgICAgICAgICAgZWxlbU1ldHJpY3MudG9wID4gYm91bmRhcmllcy50b3AgJiYKICAgICAgICAgICAgZWxlbU1ldHJpY3MuYm90dG9tIDwgYm91bmRhcmllcy5ib3R0b207CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIGJvdW5kYXJpZXMgYWNjb3JkaW5nIHRvIGRpbWVuc2lvbnMgb2YgY2FudmFzCiAgICAgKi8KICAgIGNhbGN1bGF0ZUJvdW5kYXJpZXMoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICByaWdodDogdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuY2FudmFzV2lkdGgsCiAgICAgICAgICAgIGJvdHRvbTogdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuY2FudmFzSGVpZ2h0CiAgICAgICAgfTsKICAgIH0K</text>
      </register>
      <register name="&quot;" type="2">
        <text encoding="base64">ICAgIC8qKgogICAgICogQ2hhbmdlIHRoZSBib3JkZXIgb2YgZWxlbWVudCB0byBpbmRpY2F0ZSBzZWxlY3Rpb24KICAgICAqIEBwYXJhbSB7UmVuZGVyZXJ9IHJlbmRlcmVyIC0gcmVmZXJlbmNlIHRvIGVsZW1lbnQgcmVuZGVyZXIKICAgICAqIEBwYXJhbSB7Vmlld0NvbnRhaW5lclJlZn0gdmlld1JlZiAtIHJlZmVyZW5jZSB0byBWaWV3CiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNlbGVjdGVkIC0gaWYgaXMgdG8gYWRkIG9yIHJlbW92ZSB0aGUgZWZmZWN0CiAgICAgKi8KICAgIGNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyOiBSZW5kZXJlciwgdmlld1JlZjogVmlld0NvbnRhaW5lclJlZiwgc2VsZWN0ZWQ6IGJvb2xlYW4pIHsKICAgICAgICB2aWV3UmVmLmVsZW1lbnQubmF0aXZlRWxlbWVudC5jaGlsZE5vZGVzLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgICAgIGlmIChpdGVtLmNsYXNzTmFtZSAmJiBpdGVtLmNsYXNzTmFtZS5pbmRleE9mKCdkcmFnZ2FibGUtZWxlbWVudCcpICE9PSAtMSkgewogICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0RWxlbWVudENsYXNzKGl0ZW0sICdoaWdobGlnaHQtZWxlbWVudCcsIHNlbGVjdGVkKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogRW1wdHkgdGhlIGxpc3Qgb2Ygc2VsZWN0ZWQgZWxlbWVudHMgYW5kIHJlbW92ZSB0aGUgY3NzIGVmZmVjdAogICAgICogQHBhcmFtIHtSZW5kZXJlcn0gcmVuZGVyZXIgLSByZWZlcmVuY2UgdG8gY3VycmVudCByZW5kZXJlcgogICAgICovCiAgICBlbXB0eVNlbGVjdGVkRWxlbWVudHMocmVuZGVyZXIpIHsKICAgICAgICBjb25zdCBsaXN0TGVuZ3RoID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmxlbmd0aDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3RMZW5ndGg7ICsraSkgewogICAgICAgICAgICB0aGlzLmNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyLCB0aGlzLnNlbGVjdGVkRWxlbWVudHNbaV0udmlld1JlZiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICB0aGlzLnNlbGVjdGVkRWxlbWVudHMuc3BsaWNlKDAsIGxpc3RMZW5ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBjb29yZGluYXRlcyBvZiBlbGVtZW50cyBzZWxlY3RlZCBhbmQgdXNlIHRoZSB0byBjcmVhdGUgYSBncm91cCBlbGVtZW50CiAgICAgKiB3aXRoIGNvcnJlY3Qgc2l6ZS4KICAgICAqLwogICAgY29vcmRzRm9yR3JvdXBpbmcoKSB7CiAgICAgICAgY29uc3QgY29vcmRzID0gewogICAgICAgICAgICB0b3A6IHRoaXMuc2VsZWN0ZWRFbGVtZW50c1swXS5ub2RlLmRhdGEueSwKICAgICAgICAgICAgbGVmdDogdGhpcy5zZWxlY3RlZEVsZW1lbnRzWzBdLm5vZGUuZGF0YS54LAogICAgICAgICAgICBib3R0b206IHRoaXMuc2VsZWN0ZWRFbGVtZW50c1swXS5ub2RlLmRhdGEuaGVpZ2h0LAogICAgICAgICAgICByaWdodDogdGhpcy5zZWxlY3RlZEVsZW1lbnRzWzBdLm5vZGUuZGF0YS53aWR0aCwKICAgICAgICB9OwogICAgICAgIC8vIGdvIHRocm91Z2ggZXZlcnkgaXRlbSBnZXR0aW5nIHRoZSBjb29yZGluYXRlcyBnb3IgZ3JvdXAgZWxlbWVudAogICAgICAgIHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICBjb29yZHMudG9wID0gY29vcmRzLnRvcCA+IGl0ZW0ubm9kZS5kYXRhLnkgPyBpdGVtLm5vZGUuZGF0YS55IDogY29vcmRzLnRvcDsKICAgICAgICAgICAgY29vcmRzLmxlZnQgPSBjb29yZHMubGVmdCA+IGl0ZW0ubm9kZS5kYXRhLnggPyBpdGVtLm5vZGUuZGF0YS54IDogY29vcmRzLmxlZnQ7CiAgICAgICAgICAgIGNvbnN0IHdpZHRoRnJvbUJvcmRlciA9IGl0ZW0ubm9kZS5kYXRhLnggKyBpdGVtLm5vZGUuZGF0YS53aWR0aDsKICAgICAgICAgICAgY29vcmRzLnJpZ2h0ID0gY29vcmRzLnJpZ2h0ID4gd2lkdGhGcm9tQm9yZGVyID8gY29vcmRzLnJpZ2h0IDogd2lkdGhGcm9tQm9yZGVyOwogICAgICAgICAgICBjb25zdCBoZWlnaHRGcm9tQm9yZGVyID0gaXRlbS5ub2RlLmRhdGEueSArIGl0ZW0ubm9kZS5kYXRhLmhlaWdodDsKICAgICAgICAgICAgY29vcmRzLmJvdHRvbSA9IGNvb3Jkcy5ib3R0b20gPiBoZWlnaHRGcm9tQm9yZGVyID8gY29vcmRzLmJvdHRvbSA6IGhlaWdodEZyb21Cb3JkZXI7CiAgICAgICAgfSk7CiAgICAgICAgLy8gZml4IGZvciB0aGUgc2l6ZSBvZiB0aGUgZWxlbWVudCwgbWF5YmUgc29tZSBjb25mbGljdCB3aXRoIHRoZSBwb3NpdGlvbgogICAgICAgIGNvb3Jkcy5yaWdodCA9IGNvb3Jkcy5yaWdodCAtIGNvb3Jkcy5sZWZ0OwogICAgICAgIGNvb3Jkcy5ib3R0b20gPSBjb29yZHMuYm90dG9tIC0gY29vcmRzLnRvcDsKICAgICAgICByZXR1cm4gY29vcmRzOwogICAgfQoKICAgIC8qKgogICAgICogU2VsZWN0L1VuLXNlbGVjdCB0aGUgZWxlbWVudCBjbGlja2VkLgogICAgICovCiAgICBzZWxlY3RFbGVtZW50cyh2aWV3UmVmOiBWaWV3Q29udGFpbmVyUmVmLCByZW5kZXJlcjogUmVuZGVyZXIsIG5vZGUpIHsKICAgICAgICAvLyByZW1vdmUgLyBpbnNlcnQgdG8gYSBsaXN0IG9mIHNlbGVjdGVkIGVsZW1lbnRzCiAgICAgICAgY29uc3Qgbm9kZURhdGEgPSBub2RlLmRhdGE7CiAgICAgICAgY29uc3QgY2FudmFzUmVmID0gdGhpcy5nZXRBY3RpdmVDYW52YXMoKTsKICAgICAgICBjb25zdCBub2RlSW5kZXggPSB0aGlzLnNlbGVjdGVkRWxlbWVudHMuZmluZEluZGV4KGl0ZW0gPT4gewogICAgICAgICAgICByZXR1cm4gaXRlbS5ub2RlLmRhdGEgPT09IG5vZGVEYXRhOwogICAgICAgIH0pOwogICAgICAgIC8vIGluc2VydCBpZiBub3QgZm91bmQKICAgICAgICBpZiAobm9kZUluZGV4ID09PSAtMSkgewogICAgICAgICAgICB0aGlzLmNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyLCB2aWV3UmVmLCB0cnVlKTsKICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnRzLnB1c2goe3ZpZXdSZWYsIG5vZGUsIGNhbnZhc1JlZn0pOwogICAgICAgIH0gZWxzZSB7IC8vIHJlbW92ZSBpZiBpdCB3YXMgZm91bmQKICAgICAgICAgICAgdGhpcy5jaGFuZ2VCb3JkZXJDb2xvcihyZW5kZXJlciwgdmlld1JlZiwgZmFsc2UpOwogICAgICAgICAgICB0aGlzLnNlbGVjdGVkRWxlbWVudHMuc3BsaWNlKG5vZGVJbmRleCwgMSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogR3JvdXAgZWxlbWVudHMgc2VsZWN0ZWQKICAgICAqIEBwYXJhbSBjb29yZHMgLSBjb29yZGluYXRlcyBmb3IgY3JlYXRlIGEgZ3JvdXAgImJveCIKICAgICAqIEBwYXJhbSBlbGVtZW50Q29tcG9uZW50IC0gZWxlbWVudCB0byBiZSBjcmVhdGVkCiAgICAgKiBAcGFyYW0gcmVuZGVyZXIgLSByZWZlcmVuY2Ugb2YgcmVuZGVyZXIgZWxlbWVudAogICAgICogQHBhcmFtIGRlbGV0ZUVsZW1lbnRDYWxsYmFjayAtIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSB1c2VkIHRvIGRlbGV0ZSB0aGUgZWxlbWVudHMgYWZ0ZXIgaW5zZXJ0ZWQgb24gZ3JvdXAKICAgICAqLwogICAgZ3JvdXBFbGVtZW50cyhjb29yZHMsIGVsZW1lbnRDb21wb25lbnQsIHJlbmRlcmVyLCBkZWxldGVFbGVtZW50Q2FsbGJhY2spIHsKICAgICAgICBjb25zdCB5ID0gY29vcmRzLnRvcDsKICAgICAgICBjb25zdCB4ID0gY29vcmRzLmxlZnQ7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gY29vcmRzLmJvdHRvbTsKICAgICAgICBjb25zdCB3aWR0aCA9IGNvb3Jkcy5yaWdodDsKICAgICAgICAvLyBjYW52YXMgd2hlcmUgZWxlbWVudHMgd2lsbCBiZSBhZGRlZAogICAgICAgIGNvbnN0IGNhbnZhc1JlZiA9IHRoaXMuZ2V0QWN0aXZlQ2FudmFzKCk7CiAgICAgICAgY29uc3QgY2FudmFzSWQgPSBjYW52YXNSZWYuY2FudmFzSWQ7IC8vIGNhbnZhcyBpZAogICAgICAgIGNvbnN0IGNhbnZhc0VsUmVmID0gY2FudmFzUmVmLnRoaXNSZWYuZWwubmF0aXZlRWxlbWVudDsgLy8gRE9NIGVsZW0KICAgICAgICBjb25zdCBjYW52YXNWaWV3Q2hpbGQgPSBjYW52YXNSZWYudGhpc1JlZi5jYW52YXNWaWV3UmVmOyAvLyB2aWV3Q2hpbGQgd2hlcmUgZWxlbWVudHMgYXJlIGFkZGVkCgogICAgICAgIC8vIGNyZWF0ZSBhIGdyb3VwIGVsZW1lbnQKICAgICAgICBjb25zdCBncm91cE5vZGUgPSB0aGlzLmNyZWF0ZUNhbnZhc0VsZW1lbnROb2RlKHgsIHksIHt0eXBlOiAnbm9kZSd9LCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gZ2V0IHRoZSBlbGVtZW50cyB0byBiZSBncm91cGVkCiAgICAgICAgY29uc3QgY3VycmVudENhbnZhc0VsZW1lbnRzID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmZpbHRlcigoaXRlbSkgPT4KICAgICAgICAgICAgKGl0ZW0uY2FudmFzUmVmLmNhbnZhc0lkID09PSBjYW52YXNSZWYuY2FudmFzSWQpCiAgICAgICAgKTsKCiAgICAgICAgLy8gcmVtb3ZlIHRoZW0gZnJvbSBzZWxlY3RlZCBsaXN0IGFuZCBwdXNoIGludG8gbm9kZQogICAgICAgIGN1cnJlbnRDYW52YXNFbGVtZW50cy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmluZGV4T2YoaXRlbSk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIC8vIGZpeCBwb3NpdGlvbiBvZiBub2RlCiAgICAgICAgICAgICAgICBpdGVtLm5vZGUuZGF0YS54ID0gaXRlbS5ub2RlLmRhdGEueCAtIHg7CiAgICAgICAgICAgICAgICBpdGVtLm5vZGUuZGF0YS55ID0gaXRlbS5ub2RlLmRhdGEueSAtIHk7CiAgICAgICAgICAgICAgICAvLyBjcmVhdGUgdGhlIG5vZGUgdHJlZQogICAgICAgICAgICAgICAgZ3JvdXBOb2RlLm5vZGVzLnB1c2goaXRlbS5ub2RlKTsKICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBlbGVtZW50IGZyb20gY2FudmFzCiAgICAgICAgICAgICAgICBkZWxldGVFbGVtZW50Q2FsbGJhY2soaXRlbS5ub2RlKTsKICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBlbGVtZW50IGZyb20gc2VsZWN0ZWQgbGlzdAogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUJvcmRlckNvbG9yKHJlbmRlcmVyLCBpdGVtLnZpZXdSZWYsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcjogZWxlbWVudCBub3QgZm91bmQnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBjb21wb25lbnREYXRhID0gdGhpcy5jcmVhdGVFbGVtZW50Q29tcG9uZW50KGNhbnZhc0VsUmVmLCBjYW52YXNJZCwgZ3JvdXBOb2RlLCBlbGVtZW50Q29tcG9uZW50KTsKCiAgICAgICAgdGhpcy5faW5zdGFuY2VTZXJ2aWNlLmFkZENvbXBvbmVudFRvQ29tcG9uZW50KGNhbnZhc1ZpZXdDaGlsZCwgY29tcG9uZW50RGF0YSk7CiAgICAgICAgdGhpcy5hZGRFbGVtVG9Eb2N1bWVudChncm91cE5vZGUpOwogICAgfQoKICAgIC8qKgogICAgICogVW5ncm91cCBlbGVtZW50cyBzZWxlY3RlZAogICAgICogQHBhcmFtIGVsZW1lbnRDb21wb25lbnQgLSBlbGVtZW50IHRvIGJlIGNyZWF0ZWQKICAgICAqIEBwYXJhbSBkZWxldGVFbGVtZW50Q2FsbGJhY2sgLSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZWxldGUgdGhlIGVsZW1lbnRzIGFmdGVyIGluc2VydGVkIG9uIGdyb3VwCiAgICAgKi8KICAgIHVuZ3JvdXBFbGVtZW50cyhlbGVtZW50Q29tcG9uZW50LCBkZWxldGVFbGVtZW50Q2FsbGJhY2spIHsKICAgICAgICAvLyBjYW52YXMgd2hlcmUgZWxlbWVudHMgd2lsbCBiZSBhZGRlZAogICAgICAgIGNvbnN0IGNhbnZhc1JlZiA9IHRoaXMuZ2V0QWN0aXZlQ2FudmFzKCk7CiAgICAgICAgY29uc3QgY2FudmFzSWQgPSBjYW52YXNSZWYuY2FudmFzSWQ7IC8vIGNhbnZhcyBpZAogICAgICAgIGNvbnN0IGNhbnZhc0VsUmVmID0gY2FudmFzUmVmLnRoaXNSZWYuZWwubmF0aXZlRWxlbWVudDsgLy8gRE9NIGVsZW0KICAgICAgICBjb25zdCBjYW52YXNWaWV3Q2hpbGQgPSBjYW52YXNSZWYudGhpc1JlZi5jYW52YXNWaWV3UmVmOyAvLyB2aWV3Q2hpbGQgd2hlcmUgZWxlbWVudHMgYXJlIGFkZGVkCgogICAgICAgIC8vIGdldCB0aGUgZ3JvdXBzCiAgICAgICAgY29uc3QgY3VycmVudE5vZGVFbGVtZW50cyA9IHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5maWx0ZXIoKGl0ZW0pID0+CiAgICAgICAgICAgIChpdGVtLmNhbnZhc1JlZi5jYW52YXNJZCA9PT0gY2FudmFzUmVmLmNhbnZhc0lkICYmIGl0ZW0ubm9kZS5kYXRhLnR5cGVOYW1lID09PSAnbm9kZScpCiAgICAgICAgKTsKCiAgICAgICAgLy8gcmVtb3ZlIGluc2lkZSBub2RlcyBhbmQgYWRkIHRoZW0gaW4gY2FudmFzCiAgICAgICAgY3VycmVudE5vZGVFbGVtZW50cy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zZWxlY3RlZEVsZW1lbnRzLmluZGV4T2YoaXRlbSk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGl0ZW0ubm9kZS5ub2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbm9kZS5kYXRhLnggKz0gaXRlbS5ub2RlLmRhdGEueDsKICAgICAgICAgICAgICAgICAgICBub2RlLmRhdGEueSArPSBpdGVtLm5vZGUuZGF0YS55OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudERhdGEgPSB0aGlzLmNyZWF0ZUVsZW1lbnRDb21wb25lbnQoY2FudmFzRWxSZWYsIGNhbnZhc0lkLCBub2RlLCBlbGVtZW50Q29tcG9uZW50KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVNlcnZpY2UuYWRkQ29tcG9uZW50VG9Db21wb25lbnQoY2FudmFzVmlld0NoaWxkLCBjb21wb25lbnREYXRhKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEVsZW1Ub0RvY3VtZW50KG5vZGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkZWxldGVFbGVtZW50Q2FsbGJhY2soaXRlbS5ub2RlKTsKICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRFbGVtZW50cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yOiBlbGVtZW50IG5vdCBmb3VuZCcpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgoKICAgIC8qKiBHZXQgdGhlIGxvd2VzdCBwb3NpdGlvbiAoeSBheGlzKSBvbiBjYW52YXMgKi8KICAgIGdldExvd2VzdEZyZWVQb3NpdGlvbigpOiBudW1iZXIgewogICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5nZXROb2RlcygpOwogICAgICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGxldCBib3R0b20gPSBub2Rlc1swXS5kYXRhLnkgKyBub2Rlc1swXS5kYXRhLmhlaWdodDsKICAgICAgICBub2Rlcy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICBjb25zdCBpdGVtQm90dG9tID0gaXRlbS5kYXRhLnkgKyBpdGVtLmRhdGEuaGVpZ2h0OwogICAgICAgICAgICBpZiAoYm90dG9tIDwgaXRlbUJvdHRvbSkgewogICAgICAgICAgICAgICAgYm90dG9tID0gaXRlbUJvdHRvbTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIC8vIGF2b2lkIGNvbGxpc2lvbnMsIGFkZCBvbmUgY2VsbCBoZWlnaHQgKC0xIHRvIG5vdCBqdW1wIHRoZSB3aG9sZSBjZWxsKSB0byBtb3ZlIHRvIHRoZSBuZXh0IGNlbGwKICAgICAgICBib3R0b20gKz0gdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQudlNpemUgLSAxOwogICAgICAgIC8vIHJvd3MgLTEgaXMgdG8gbm90IGFkZCBpbiB0aGUgbGFzdCBncmlkIHBvaW50IChvdXQgb2YgY2FudmFzKQogICAgICAgIGlmIChib3R0b20gPj0gKHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplICogKHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnJvd3MgLSAxKSkpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYm90dG9tOwogICAgfQoKICAgIC8qKiBHZXQgdGhlIHdpZHRoIG9mIHRoZSBjYW52YXMgZm9yIHRoZSBhZGRlZCBlbGVtZW50LCAtMiB0byBiZSBpbnNpZGUgb2YgdGhlIGJvdW5kYXJpZXMgKi8KICAgIGdldEZ1bGxDYW52YXNXaWR0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuY2FudmFzV2lkdGggLSAyOwogICAgfQoKICAgIC8qKgogICAgICogVHJlYXQgZWxlbWVudHMgd2hlbiBpdCBjb2xsaWRlcywgaWYgbW92aW5nIHRoZSBvdGhlciBvYmplY3RzIHdpbGwgY2hhbmdlIHRoZSBwb3NpdGlvbgogICAgICogaWYgcmVzaXppbmcgdGhlIG9iamVjdCB3aWxsIHN0b3AgdG8gaW5jcmVhc2UuIE5vdGljZSB0aGF0IHdoZW4gbW92aW5nIGl0IG5vdCByZXR1cm4gdHJ1ZSBidXQKICAgICAqIGNoYW5nZSB0aGUgb3RoZXIgZWxlbWVudHMgcG9zaXRpb24gaW5zdGVhZC4KICAgICAqIEBwYXJhbSB7YW55fSBwb3MgLSBuZXcgcG9zaXRpb24gb2YgZWxlbWVudCAoc3RyaWN0IHRvIG1vdXNlIHBvc2l0aW9uIG9yIGVsZW1lbnQgaGVpZ2h0IGFuZCB3aWR0aCkKICAgICAqIEBwYXJhbSB7YW55fSBub2RlIC0gdGhlIGN1cnJlbnQgbm9kZSBiZWluZyB1c2VkCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZSAtICdtb3ZlJyBvciAncmVzaXplJwogICAgICogQHJldHVybnMge2Jvb2xlYW59IGlzIGNvbGxpZGluZyBvciBub3QKICAgICAqLwogICAgaXNDb2xsaWRpbmcocG9zLCBub2RlLCBtb2RlKSB7CiAgICAgICAgLy8gaWYgaXMgbW92aW5nIGVsZW1lbnQgcG9zIHNob3VsZCBiZSBjYWxjdWxhdGVkIGZyb20gc25hcCBwb2ludHMKICAgICAgICBjb25zdCBuZXdQb3MgPSBtb2RlID09PSAnbW92ZScgPyB0aGlzLmdldFNuYXBQb2ludChwb3MubGVmdCwgcG9zLnRvcCkgOiBwb3M7CgogICAgICAgIC8vIHBvcyB3aGlsZSByZXNpemluZyBoYXMgaW5mb3JtYXRpb24gYWJvdXQgZWxlbWVudCB3aWR0aCBhbmQgaGVpZ2h0CiAgICAgICAgY29uc3QgYSA9IHRoaXMuX2dldEN1cnJlbnROb2RlTWV0cmljcyhub2RlLCBuZXdQb3MsIG1vZGUpOwoKICAgICAgICAvLyBnZXQgYWxsIG5vZGVzIGluIGNhbnZhcwogICAgICAgIGNvbnN0IG5vZGVzID0gdGhpcy5nZXROb2RlcygpOwoKICAgICAgICAvLyBydW4gdHJvdWdoIGFsbCBlbGVtZW50cyBhbmQgc2VlIGlmIGl0IHdpbGwgY29sbGlkZQogICAgICAgIGZvciAoY29uc3QgX25vZGUgb2Ygbm9kZXMpIHsKICAgICAgICAgICAgaWYgKF9ub2RlICE9PSBub2RlKSB7CiAgICAgICAgICAgICAgICAvLyB0YWtlIHRoZSBtZWFzdXJlcwogICAgICAgICAgICAgICAgY29uc3QgYiA9IHRoaXMuX2dldE90aGVyTm9kZXNNZXRyaWNzKF9ub2RlKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl93aWxsQ29sbGlkZShhLCBiKSkgewogICAgICAgICAgICAgICAgICAgIC8vIG1vdmluZyBmcm9tIHNpZGVzLCByZXR1cm4gdGhhdCB3aWxsIGNvbGxpZGUgYW5kIGRvbid0IG1vdmUKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5kYXRhLnkgPT09IF9ub2RlLmRhdGEueSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGlmIGlzIHJlc2l6aW5nLCBqdXN0IHJldHVybiB0cnVlIHRvIHN0b3AgdGhlIG9iamVjdCB0byBjaGFuZ2UgdGhlIHNpemUKICAgICAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gJ3Jlc2l6ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB3aGlsZSBtb3ZpbmcgYW4gb2JqZWN0IHRoZSBjdXJyZW50IG9iamVjdCBzaG91bGQgbW92ZSBvdGhlciBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGUgPT09ICdtb3ZlJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fZWxlbU1vdmVkVXAobm9kZSwgX25vZGUpICYmIHRoaXMuX2VsZW1BdEZpcnN0Q2VsbE9uQ29uZmxpY3QocG9zLCBfbm9kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvc1RvTW92ZSA9IHRoaXMuX3BsYWNlVG9Nb3ZlRG93bihuZXdQb3MsIG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX25vZGUuZGF0YS55ID0gdGhpcy5nZXRTbmFwUG9pbnQoX25vZGUuZGF0YS54LCBwb3NUb01vdmUpLnRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9lbGVtTW92ZWREb3duKG5vZGUsIF9ub2RlKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VsZW1BdExhc3RDZWxsT25Db25mbGljdChwb3MsIG5vZGUsIF9ub2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zVG9Nb3ZlID0gdGhpcy5fcGxhY2VUb01vdmVVcChub2RlLCBfbm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfbm9kZS5kYXRhLnkgPSB0aGlzLmdldFNuYXBQb2ludChfbm9kZS5kYXRhLngsIHBvc1RvTW92ZSkudG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB1bmV4cGVjdGVkIHNpdHVhdGlvbnMgd2hpbGUgbW92aW5nLCByZXR1cm4gdHJ1ZSBhbmQgZG9uJ3QgbW92ZQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBfZ2V0Q3VycmVudE5vZGVNZXRyaWNzKG5vZGUsIHBvcywgbW9kZSk6IGFueSB7CiAgICAgICAgY29uc3QgYTogYW55ID0ge307CiAgICAgICAgYS5yaWdodCA9IG1vZGUgPT09ICdyZXNpemUnID8gbm9kZS5kYXRhLnggKyBwb3Mud2lkdGggOiBub2RlLmRhdGEud2lkdGggKyBwb3MubGVmdDsKICAgICAgICBhLmxlZnQgPSBtb2RlID09PSAnbW92ZScgPyBwb3MubGVmdCA6IG5vZGUuZGF0YS54OwogICAgICAgIGEuYm90dG9tID0gbW9kZSA9PT0gJ3Jlc2l6ZScgPyBub2RlLmRhdGEueSArIHBvcy5oZWlnaHQgOiBub2RlLmRhdGEuaGVpZ2h0ICsgcG9zLnRvcDsKICAgICAgICBhLnRvcCA9IG1vZGUgPT09ICdtb3ZlJyA/IHBvcy50b3AgOiBub2RlLmRhdGEueTsKICAgICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBfZ2V0T3RoZXJOb2Rlc01ldHJpY3Mobm9kZSk6IGFueSB7CiAgICAgICAgY29uc3QgYjogYW55ID0ge307CiAgICAgICAgYi5yaWdodCA9IG5vZGUuZGF0YS54ICsgbm9kZS5kYXRhLndpZHRoOwogICAgICAgIGIubGVmdCA9IG5vZGUuZGF0YS54OwogICAgICAgIGIuYm90dG9tID0gbm9kZS5kYXRhLnkgKyBub2RlLmRhdGEuaGVpZ2h0OwogICAgICAgIGIudG9wID0gbm9kZS5kYXRhLnk7CiAgICAgICAgcmV0dXJuIGI7CiAgICB9CgogICAgX3dpbGxDb2xsaWRlKGE6IGFueSwgYjogYW55KSB7CiAgICAgICAgcmV0dXJuIGIucmlnaHQgPiBhLmxlZnQgJiYgYS5yaWdodCA+IGIubGVmdCAmJiBiLmJvdHRvbSA+IGEudG9wICYmIGEuYm90dG9tID4gYi50b3A7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBPVEhFUiBlbGVtZW50IHNob3VsZCBiZSBwbGFjZWQgKGRvd24pIHdoaWxlIHRoZSBjdXJyZW50CiAgICAgKiBlbGVtZW50IGlzIGJlaW5nIG1vdmVkIHVwLgogICAgICogQHBhcmFtIHBvcyAtIGN1cnJlbnQgbW91c2UgcG9zaXRpb24KICAgICAqIEBwYXJhbSBjdXJyZW50Tm9kZSAtIG5vZGUgYmVpbmcgbW92ZWQKICAgICAqLwogICAgX3BsYWNlVG9Nb3ZlRG93bihwb3MsIGN1cnJlbnROb2RlKSB7CiAgICAgICAgaWYgKGN1cnJlbnROb2RlLmRhdGEuaGVpZ2h0IDw9IHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplKSB7CiAgICAgICAgICAgIHJldHVybiBwb3MudG9wICsgdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQudlNpemU7CiAgICAgICAgfQogICAgICAgIC8vIG51bWJlciBvZiBjZWxscyBiZWluZyBvY2N1cGllZCBieSBlbGVtZW50CiAgICAgICAgY29uc3QgY2VsbHMgPSBjdXJyZW50Tm9kZS5kYXRhLmhlaWdodCAvIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplICsgMTsKICAgICAgICByZXR1cm4gcG9zLnRvcCArIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplICogY2VsbHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIHBvc2l0aW9uIHdoZXJlIHRoZSBPVEhFUiBlbGVtZW50IHNob3VsZCBiZSBwbGFjZWQgKHVwKSB3aGlsZSB0aGUgY3VycmVudAogICAgICogZWxlbWVudCBpcyBiZWluZyBtb3ZlZCBkb3duLgogICAgICogQHBhcmFtIGN1cnJlbnROb2RlIC0gbm9kZSBiZWluZyBtb3ZlZAogICAgICogQHBhcmFtIG90aGVyTm9kZSAtIG5vZGUgYmVpbmcgYWZmZWN0ZWQgYnkgbW92ZWQgZWxlbWVudAogICAgICovCiAgICBfcGxhY2VUb01vdmVVcChjdXJyZW50Tm9kZSwgb3RoZXJOb2RlKSB7CiAgICAgICAgaWYgKGN1cnJlbnROb2RlLmRhdGEuaGVpZ2h0ID4gb3RoZXJOb2RlLmRhdGEuaGVpZ2h0KSB7CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiBlbGVtZW50IGlzIGJlaW5nIG1vdmVkIGRvd24KICAgICAqIEBwYXJhbSBjdXJyZW50Tm9kZSAtIG5vZGUgYmVpbmcgbW92ZWQKICAgICAqIEBwYXJhbSBvdGhlck5vZGUgLSBub2RlIGJlaW5nIGFmZmVjdGVkIGJ5IG1vdmVkIG5vZGUKICAgICAqLwogICAgX2VsZW1Nb3ZlZERvd24oY3VycmVudE5vZGUsIG90aGVyTm9kZSkgewogICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnkgPCBvdGhlck5vZGUuZGF0YS55OwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgZWxlbWVudCBpcyBiZWluZyBtb3ZlZCB1cAogICAgICogQHBhcmFtIGN1cnJlbnROb2RlIC0gbm9kZSBiZWluZyBtb3ZlZAogICAgICogQHBhcmFtIG90aGVyTm9kZSAtIG5vZGUgYmVpbmcgYWZmZWN0ZWQgYnkgbW92ZWQgbm9kZQogICAgICovCiAgICBfZWxlbU1vdmVkVXAoY3VycmVudE5vZGUsIG90aGVyTm9kZSkgewogICAgICAgIHJldHVybiBjdXJyZW50Tm9kZS5kYXRhLnkgPiBvdGhlck5vZGUuZGF0YS55OwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGVsZW1lbnQgYmVpbmcgbW92ZWQgaXMgaW4gdGhlIGZpcnN0IGNlbGwgb2YgYWZmZWN0ZWQgZWxlbWVudC4KICAgICAqIE5PVElDRTogdGhpcyBpcyBhIHdvcmthcm91bmQgdG8gdHJ5IGF2b2lkIHNvbWUgb3ZlcmxhcHBpbmcgd2l0aCBiaWcgZWxlbWVudHMgdGhhbiBvbmUgY2VsbCBlbGVtZW50cy4KICAgICAqIEBwYXJhbSBwb3MgLSBjdXJyZW50IG1vdXNlIHBvcwogICAgICogQHBhcmFtIG90aGVyTm9kZSAtIG5vZGUgYmVpbmcgYWZmZWN0ZWQgYnkgbW92ZWQgbm9kZQogICAgICovCiAgICBfZWxlbUF0Rmlyc3RDZWxsT25Db25mbGljdChwb3MsIG90aGVyTm9kZSkgewogICAgICAgIHJldHVybiBNYXRoLmFicyhwb3MudG9wIC0gb3RoZXJOb2RlLmRhdGEueSkgPCB0aGlzLkNBTlZBU19DT05GSUcuZ3JpZC52U2l6ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBlbGVtZW50IGJlaW5nIG1vdmVkIGlzIGluIHRoZSBsYXN0IGNlbGwgb2YgYWZmZWN0ZWQgZWxlbWVudC4KICAgICAqIE5PVElDRTogdGhpcyBpcyBhIHdvcmthcm91bmQgdG8gdHJ5IGF2b2lkIHNvbWUgb3ZlcmxhcHBpbmcgd2l0aCBiaWdnZXIgdGhhbiBvbmUgY2VsbCBlbGVtZW50cy4KICAgICAqIEBwYXJhbSBwb3MgLSBjdXJyZW50IG1vdXNlIHBvcwogICAgICogQHBhcmFtIGN1cnJlbnROb2RlIC0gY3VycmVudCBub2RlIGJlaW5nIG1vdmVkCiAgICAgKiBAcGFyYW0gb3RoZXJOb2RlIC0gbm9kZSBiZWluZyBhZmZlY3RlZCBieSBtb3ZlZCBub2RlCiAgICAgKi8KICAgIF9lbGVtQXRMYXN0Q2VsbE9uQ29uZmxpY3QocG9zLCBjdXJyZW50Tm9kZSwgb3RoZXJOb2RlKSB7CiAgICAgICAgaWYgKG90aGVyTm9kZS5kYXRhLmhlaWdodCA8IGN1cnJlbnROb2RlLmRhdGEuaGVpZ2h0KSB7CiAgICAgICAgICAgIHJldHVybiBwb3MudG9wICsgY3VycmVudE5vZGUuZGF0YS5oZWlnaHQgPiBvdGhlck5vZGUuZGF0YS55ICsgb3RoZXJOb2RlLmRhdGEuaGVpZ2h0OwogICAgICAgIH0KICAgICAgICBjb25zdCB2U2l6ZXNNdWx0ID0gTWF0aC5jZWlsKG90aGVyTm9kZS5kYXRhLmhlaWdodCAvIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplKSAtIDE7CiAgICAgICAgY29uc3QgY29uZlNwYWNlID0gdlNpemVzTXVsdCAqIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplOwogICAgICAgIHJldHVybiBwb3MudG9wID4gb3RoZXJOb2RlLmRhdGEueSArIGNvbmZTcGFjZTsKICAgIH0KCiAgICAvKiogR2V0IG5vZGUgbGlzdCBvZiBzZWxlY3RlZFRhYiAqLwogICAgZ2V0Tm9kZXMoKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRMYW5nID0gdGhpcy5fZGFzaGJvYXJkU2VydmljZS5zZWxlY3RlZFRhYi50YWJTdGF0ZS5jdXJyTGFuZ0NvZGU7CiAgICAgICAgaWYgKHRoaXMuX2Rhc2hib2FyZFNlcnZpY2Uuc2VsZWN0ZWRUYWIuZG9jdW1lbnQudHlwZSA9PT0gJ05HQVRFX01BU1RFUicpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Rhc2hib2FyZFNlcnZpY2Uuc2VsZWN0ZWRUYWIuZG9jdW1lbnQubmdhdGVzW3NlbGVjdGVkTGFuZ10KICAgICAgICAgICAgICAgIC5ncmFwaGljc1JlcHJlc2VudGF0aW9uLmVsZW1lbnRzLm5vZGVzOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5fZGFzaGJvYXJkU2VydmljZS5zZWxlY3RlZFRhYi5kb2N1bWVudC50eXBlID09PSAnTE9HSUNfTUFTVEVSJykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGFzaGJvYXJkU2VydmljZS5zZWxlY3RlZFRhYi5kb2N1bWVudC5sb2dpY3Nbc2VsZWN0ZWRMYW5nXS5lbGVtZW50cy5ub2RlczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgZWxlbWVudCBpcyBpbiBwb3NpdGlvbiBhY2NvcmRpbmcgdG8gYm91bmRhcnkgZWxlbWVudAogICAgICogZS5nLiBkcmFnZ2FibGUgZWxlbWVudCBpcyBzdGlsbCBpbnNpZGUgY2FudmFzCiAgICAgKiBAcGFyYW0gYm91bmRhcmllcyAtIG9iamVjdCB3aXRoIGJvdW5kYXJpZXMgbWV0cmljcwogICAgICogQHBhcmFtIGxlZnQKICAgICAqIEBwYXJhbSB0b3AKICAgICAqIEBwYXJhbSB3aWR0aAogICAgICogQHBhcmFtIGhlaWdodAogICAgICogQHJldHVybnMge2Jvb2xlYW59IGlmIGlzIG9yIGlzIG5vdCBpbiBib3VuZGFyaWVzCiAgICAgKi8KCiAgICBpc0luQm91bmRhcmllcyhib3VuZGFyaWVzLCBsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAvLyBnZXQgc25hcCBwb2ludHMgcG9zaXRpb24KICAgICAgICBjb25zdCBuZXdQb3MgPSB0aGlzLmdldFNuYXBQb2ludChsZWZ0LCB0b3ApOwogICAgICAgIGNvbnN0IGVsZW1NZXRyaWNzID0gewogICAgICAgICAgICBsZWZ0OiBuZXdQb3MubGVmdCwKICAgICAgICAgICAgdG9wOiBuZXdQb3MudG9wLAogICAgICAgICAgICByaWdodDogbmV3UG9zLmxlZnQgKyB3aWR0aCwKICAgICAgICAgICAgYm90dG9tOiBuZXdQb3MudG9wICsgaGVpZ2h0CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZWxlbU1ldHJpY3MubGVmdCA+IGJvdW5kYXJpZXMubGVmdCAmJgogICAgICAgICAgICBlbGVtTWV0cmljcy5yaWdodCA8IGJvdW5kYXJpZXMucmlnaHQgJiYKICAgICAgICAgICAgZWxlbU1ldHJpY3MudG9wID4gYm91bmRhcmllcy50b3AgJiYKICAgICAgICAgICAgZWxlbU1ldHJpY3MuYm90dG9tIDwgYm91bmRhcmllcy5ib3R0b207CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIGJvdW5kYXJpZXMgYWNjb3JkaW5nIHRvIGRpbWVuc2lvbnMgb2YgY2FudmFzCiAgICAgKi8KICAgIGNhbGN1bGF0ZUJvdW5kYXJpZXMoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbGVmdDogMCwKICAgICAgICAgICAgdG9wOiAwLAogICAgICAgICAgICByaWdodDogdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuY2FudmFzV2lkdGgsCiAgICAgICAgICAgIGJvdHRvbTogdGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuY2FudmFzSGVpZ2h0CiAgICAgICAgfTsKICAgIH0K</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgIC8vIGl0ZW0gdG8gYmUgY3JlYXRlZCBhbmQgYWRkZWQgdG8gY2FudmFzCiAgICBwdWJsaWMgc2VsZWN0ZWRFbGVtZW50cyA9IFtdOwogICAgcHJpdmF0ZSBlbGVtVG9BZGQ7CiAgICBwcml2YXRlIGVsZW1Ub0FkZE9mZnNldFg7CiAgICBwcml2YXRlIGVsZW1Ub0FkZE9mZnNldFk7Cgo=</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgcG9pbnRzIGluIHRoZSBncmlkCiAgICAgKiBAcGFyYW0ge251bWJlcn0gaFNpemUgLSBob3Jpem9udGFsIHNpemUgb2YgdGhlIGNlbGwKICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2U2l6ZSAtIHZlcnRpY2FsIHNpemUgb2YgdGhlIGNlbGwKICAgICAqIEByZXR1cm5zIHt7IGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIgfVtdfSAtIGFycmF5IG9mIHRoZSBncmlkIHBvaW50cwogICAgICovCiAgICBnZXRHcmlkUG9pbnRzKGhTaXplOiBudW1iZXIsIHZTaXplOiBudW1iZXIpOiB7IGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIgfVtdIHsKICAgICAgICBjb25zdCBncmlkOiB7IGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIgfVtdID0gW107CiAgICAgICAgbGV0IGxlZnQgPSAwOwogICAgICAgIGxldCB0b3AgPSAwOwogICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLkNBTlZBU19DT05GSUcuZ3JpZC5yb3dzOwogICAgICAgIGNvbnN0IGNvbHMgPSB0aGlzLkNBTlZBU19DT05GSUcuZ3JpZC5jb2x1bW5zOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm93czsgKytpKSB7CiAgICAgICAgICAgIGxlZnQgPSBoU2l6ZSAqIGk7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7CiAgICAgICAgICAgICAgICB0b3AgPSB2U2l6ZSAqIGo7CiAgICAgICAgICAgICAgICBncmlkLnB1c2goe2xlZnQsIHRvcH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBncmlkOwogICAgfQo=</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgIC8qKgogICAgICogQ2FsY3VsYXRlIHdoZXJlIHRoZSBlbGVtZW50IG11c3QgYmUgd2hpbGUgZHJhZ2dpbmcKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0IC0geCBwb3NpdGlvbiBvZiBlbGVtZW50CiAgICAgKiBAcGFyYW0ge251bWJlcn0gdG9wICAtIHkgcG9zaXRpb24gb2YgZWxlbWVudAogICAgICovCiAgICBnZXRTbmFwUG9pbnQobGVmdDogbnVtYmVyLCB0b3A6IG51bWJlcikgewogICAgICAgIGNvbnN0IGdyaWQgPSB0aGlzLmdldEdyaWRQb2ludHModGhpcy5DQU5WQVNfQ09ORklHLmdyaWQuaFNpemUsIHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLnZTaXplKTsKCiAgICAgICAgaWYgKGxlZnQgPCBncmlkWzBdLmxlZnQpIHsKICAgICAgICAgICAgbGVmdCA9IGdyaWRbMF0ubGVmdDsKICAgICAgICB9CiAgICAgICAgaWYgKHRvcCA8IGdyaWRbMF0udG9wKSB7CiAgICAgICAgICAgIHRvcCA9IGdyaWRbMF0udG9wOwogICAgICAgIH0KICAgICAgICBpZiAobGVmdCA+IGdyaWRbZ3JpZC5sZW5ndGggLSAxXS5sZWZ0KSB7CiAgICAgICAgICAgIGxlZnQgPSBncmlkW2dyaWQubGVuZ3RoIC0gMV0ubGVmdDsKICAgICAgICB9CiAgICAgICAgaWYgKHRvcCA+IGdyaWRbZ3JpZC5sZW5ndGggLSAxXS50b3ApIHsKICAgICAgICAgICAgdG9wID0gZ3JpZFtncmlkLmxlbmd0aCAtIDFdLnRvcDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBncmlkLmZpbmQoaXRlbSA9PiB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmFicyhpdGVtLmxlZnQgLSBsZWZ0KSA8IHRoaXMuQ0FOVkFTX0NPTkZJRy5ncmlkLmhTaXplICYmCiAgICAgICAgICAgICAgICBNYXRoLmFicyhpdGVtLnRvcCAtIHRvcCkgPCB0aGlzLkNBTlZBU19DT05GSUcuZ3JpZC52U2l6ZTsKICAgICAgICB9KTsKICAgIH0KCg==</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgIC8qKgogICAgICogQWZ0ZXIgZHJvcHBpbmcgZWxlbWVudCBvdmVyIGNhbnZhcywgYWRkIGl0IHRvIGNhbnZhcyB0aHJvdWdoIGl0cyBWaWV3Q2hpbGQKICAgICAqIEdldCByZWZlcmVuY2Ugb2YgY2FudmFzLCBpdCdzIGlkLCBkb20gZWxlbSwgdmlld0NoaWxkLCBjcmVhdGUgZWxlbWVudAogICAgICogYWNjb3JkaW5nIHRvIHJpYmJvbiBlbGVtZW50IGFuZCBhZGQgdG8gY2FudmFzCiAgICAgKi8KICAgIGFkZEVsZW1Ub0NhbnZhcyhldmVudCwgaXRlbSwgY29tcG9uZW50LCB4PywgeT8pIHsKICAgICAgICAvLyBjYW52YXMgd2hlcmUgZWxlbWVudHMgd2lsbCBiZSBhZGRlZAogICAgICAgIGNvbnN0IGNhbnZhc1JlZjogYW55ID0gdGhpcy5nZXRBY3RpdmVDYW52YXMoKTsKICAgICAgICBjb25zdCBjYW52YXNJZCA9IGNhbnZhc1JlZi5jYW52YXNJZDsgLy8gY2FudmFzIGlkCiAgICAgICAgY29uc3QgY2FudmFzRWxSZWYgPSBjYW52YXNSZWYudGhpc1JlZi5lbC5uYXRpdmVFbGVtZW50OyAvLyBET00gZWxlbQogICAgICAgIGNvbnN0IGNhbnZhc1ZpZXdDaGlsZCA9IGNhbnZhc1JlZi50aGlzUmVmLmNhbnZhc1ZpZXdSZWY7IC8vIHZpZXdDaGlsZCB3aGVyZSBlbGVtZW50cyBhcmUgYWRkZWQKCiAgICAgICAgY2FudmFzUmVmLnRoaXNSZWYuZWxlbWVudElzRHJhZ2dlZE92ZXIgPSBmYWxzZTsgLy8gcmVtb3ZlIGRyYWcgb3ZlciBjbGFzcwoKICAgICAgICAvLyBjYWxjdWxhdGUgcG9zaXRpb24gZm9yIGRyb3AKICAgICAgICBpZiAoIXggfHwgIXkpIHsKICAgICAgICAgICAgeCA9IGV2ZW50LmNsaWVudFggLSAkKGNhbnZhc0VsUmVmKS5vZmZzZXQoKS5sZWZ0IC0gdGhpcy5nZXRFbGVtVG9BZGRPZmZzZXRYKCk7CiAgICAgICAgICAgIHkgPSBldmVudC5jbGllbnRZIC0gJChjYW52YXNFbFJlZikub2Zmc2V0KCkudG9wIC0gdGhpcy5nZXRFbGVtVG9BZGRPZmZzZXRZKCkgKyAkKCdib2R5Jykuc2Nyb2xsVG9wKCk7CiAgICAgICAgfQogICAgICAgIC8vIG1vdmUgdG8gc25hcCBwb2ludHMKICAgICAgICBjb25zdCBwb3MgPSB0aGlzLmdldFNuYXBQb2ludCh4LCB5KTsKICAgICAgICBjb25zdCBub2RlID0gdGhpcy5jcmVhdGVDYW52YXNFbGVtZW50Tm9kZShwb3MubGVmdCwgcG9zLnRvcCwgaXRlbSk7CiAgICAgICAgY29uc3QgY29tcG9uZW50RGF0YSA9IHRoaXMuY3JlYXRlRWxlbWVudENvbXBvbmVudChjYW52YXNFbFJlZiwgY2FudmFzSWQsIG5vZGUsIGNvbXBvbmVudCk7CgogICAgICAgIC8vIGR5bmFtaWNhbGx5IGNyZWF0ZSBjb21wb25lbnQgdXNpbmcgcmVzb2x2ZXIKICAgICAgICB0aGlzLl9pbnN0YW5jZVNlcnZpY2UuYWRkQ29tcG9uZW50VG9Db21wb25lbnQoY2FudmFzVmlld0NoaWxkLCBjb21wb25lbnREYXRhKTsKCiAgICAgICAgdGhpcy5hZGRFbGVtVG9Eb2N1bWVudChub2RlKTsKICAgIH0KCg==</text>
      </register>
      <register name="7" type="4">
        <text encoding="base64">Z2V0Q2FudmFzKGRvY3VtZW50KSB7CiAgICAgICAgY29uc3QgbmdhdGVzID0gZG9jdW1lbnQubmdhdGVzOwogICAgICAgIG5nYXRlcy5mb3JFYWNoKG5nYXRlID0+IHsKCiAgICAgICAgfSkKICAgIH0=</text>
      </register>
      <register name=":" type="4">
        <text>%s/this.CANVAS_CONFIG/this._dndService.CANVAS_CONFIG/g</text>
      </register>
      <register name="-" type="4">
        <text>public</text>
      </register>
      <register name="/" type="4">
        <text>createEle</text>
      </register>
    </registers>
    <search>
      <last-search>createEle</last-search>
      <last-offset />
      <last-pattern>createEle</last-pattern>
      <last-replace>this._dndService.CANVAS_CONFIG</last-replace>
      <last-substitute>this.CANVAS_CONFIG</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>getsnap</entry>
        <entry>getSna</entry>
        <entry>getGri</entry>
        <entry>a</entry>
        <entry>this.CANVAS_CONFIG</entry>
        <entry>getAc</entry>
        <entry>canvasItem</entry>
        <entry>createelem</entry>
        <entry>createEle</entry>
      </history-search>
      <history-cmd>
        <entry>split</entry>
        <entry>vsplit</entry>
        <entry>w</entry>
        <entry>s/a/b/gc</entry>
        <entry>s/this.CANVAS_CONFIG/this._dndService/g</entry>
        <entry>%s/this.CANVAS_CONFIG/this._dndService/g</entry>
        <entry>%s/this.CANVAS_CONFIG/this._dndService.CANVAS_CONFIG/g</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>